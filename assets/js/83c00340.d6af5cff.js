"use strict";(globalThis.webpackChunkampache_org_docs=globalThis.webpackChunkampache_org_docs||[]).push([[2386],{6850(e,t,a){a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"docs/help/import-lastfm-data","title":"Import Last.FM data","description":"Import Last.FM data into Ampache","source":"@site/docs/docs/help/import-lastfm-data.md","sourceDirName":"docs/help","slug":"/docs/help/import-lastfm-data","permalink":"/docs/help/import-lastfm-data","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Import Last.FM data","metaTitle":"Import Last.FM data","description":"Import Last.FM data into Ampache"},"sidebar":"api","previous":{"title":"Charts and Graphs","permalink":"/docs/help/troubleshooting/chart-faq"},"next":{"title":"Ampache + Icecast & Liquidsoap","permalink":"/docs/configuration/Ampache-Icecast-and-Liquidsoap"}}');var s=a(4848),o=a(8453);const i={title:"Import Last.FM data",metaTitle:"Import Last.FM data",description:"Import Last.FM data into Ampache"},r=void 0,d={},l=[{value:"Import Last.FM info into Ampache",id:"import-lastfm-info-into-ampache",level:2},{value:"Export your data",id:"export-your-data",level:2},{value:"Example of exported data",id:"example-of-exported-data",level:3},{value:"Import to date into Ampache",id:"import-to-date-into-ampache",level:2},{value:"Things to remember",id:"things-to-remember",level:2},{value:"Clean up and duplication",id:"clean-up-and-duplication",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.RP)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"import-lastfm-info-into-ampache",children:"Import Last.FM info into Ampache"}),"\n",(0,s.jsx)(t.p,{children:"Before I started really using Ampache I scrobbled. I had years of information kept in Last.FM and that data is really important."}),"\n",(0,s.jsx)(t.p,{children:"It keeps track of play counts and flagged (Loved) songs and can help you keep track of what you actually like."}),"\n",(0,s.jsxs)(t.p,{children:["Data is ",(0,s.jsx)(t.strong,{children:"KING"})," when your library grows so lets get your history into your new source of truth."]}),"\n",(0,s.jsx)(t.p,{children:"The Last.FM API does have a total play count for your user but we need to export the actual play history as Ampache will delete plays that do not exist in the object_count table."}),"\n",(0,s.jsx)(t.h2,{id:"export-your-data",children:"Export your data"}),"\n",(0,s.jsx)(t.p,{children:"First up, you need to export your data to a local file."}),"\n",(0,s.jsxs)(t.p,{children:["Download this python export script ",(0,s.jsx)(t.a,{href:"https://github.com/lachlan-00/lastscrape-gui/blob/master/lastexport3.py",children:"lastexport3"})," to pull down the data from Last.FM."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"python3 lastexport3.py -u UserName -o dump.txt\npython3 lastexport3.py -u UserName -o loved.txt -t loved\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"note"})," this should also work with Libre.FM as long as the export data is the same format using the ",(0,s.jsx)(t.code,{children:"--server"})," parameter"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:"https://github.com/user-attachments/assets/35db5d43-f8ce-453c-87cb-f02a2c97d094",alt:"image"})}),"\n",(0,s.jsx)(t.h3,{id:"example-of-exported-data",children:"Example of exported data"}),"\n",(0,s.jsx)(t.p,{children:"The exported data is tab separated (tsv) and will give you the date, title, artist, album and MBID data (if available)"}),"\n",(0,s.jsx)(t.p,{children:"scrobbles"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-tsv",children:"1722981225    Watch Out    Marvel\u2019s Spidey and His Amazing Friends - Cast    Disney Junior Music: Marvel's Spidey and His Amazing Friends - Glow Webs Glow\n1722980076    Watch Out    Marvel\u2019s Spidey and His Amazing Friends - Cast    Disney Junior Music: Marvel's Spidey and His Amazing Friends - Glow Webs Glow\n1722979963    Pickle Family    Blaze and the Monster Machines    Rockin' Ride-Along Songs, Vol. 2\n1722979866    Pickle Family    Blaze and the Monster Machines    Rockin' Ride-Along Songs, Vol. 2\n1722979755    My Bath, My Bubbles and Me    SuperKitties - Cast    Disney Junior Music: SuperKitties Su-purr Edition\n"})}),"\n",(0,s.jsx)(t.p,{children:"loved"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-tsv",children:"1665559412    Dig    Mudvayne        03a58365-bdb0-3ffa-a5e3-c37dd9ad9d21    f1c8da15-b408-4149-b863-f1cbe9971f19\n1665559411    I Am Nothing    Stabbing Westward        b7700d8d-36a8-436e-ab27-5035924209ac    6f29020d-49c1-4e26-869a-0603d14b7ca7\n1652361377    Agony    Neuroticfish        889451c3-831a-46f8-a93f-ed478a367d6c    7d83bd42-d2c7-4b56-90d1-16717cfbcc98\n"})}),"\n",(0,s.jsx)(t.h2,{id:"import-to-date-into-ampache",children:"Import to date into Ampache"}),"\n",(0,s.jsxs)(t.p,{children:["The import script has been updated recently to support Python 3.12 and has been tested on Ampache 6+. ",(0,s.jsx)(t.a,{href:"https://github.com/lachlan-00/ampache-scripts/blob/master/update_ampache_from_file2.py",children:"update_ampache_from_file2.py"})]}),"\n",(0,s.jsx)(t.p,{children:"You can hardcode the variables inside the file or use a CSV config file in the same folder as the update script."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:"https://github.com/user-attachments/assets/8a1a3b8d-1a8b-4d38-9190-6f463c38162f",alt:"image"})}),"\n",(0,s.jsx)(t.p,{children:"If you want to create a config file, call it ampache.csv and put in your details"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csv",children:"# Ampache variables\nampache_url,https://music..com.au\nampache_user,username\nampache_api,supersecretapikey\n"})}),"\n",(0,s.jsx)(t.p,{children:"When you have your dump and loved files, copy them and call them dump.txt and loved.txt."}),"\n",(0,s.jsx)(t.p,{children:"There are CLI switches you can use or manually hardcode things as well in the file."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"/d:filename.txt   Use a different dump file name (default dump.txt)\n/l:filename.txt   Use a different loved file name (default loved.txt))\n/c:filename.txt   Check a file has the full tab separated rows\n/all              print all output rows\n/silent           print nothing\n/errors or /error print error messages only\n"})}),"\n",(0,s.jsx)(t.h2,{id:"things-to-remember",children:"Things to remember"}),"\n",(0,s.jsx)(t.p,{children:"You might have some poor data or data that doesn't match your current tags. This script will look for songs that match the data you give it."}),"\n",(0,s.jsx)(t.p,{children:"I had to manually edit a lot of information as I had fixed up a lot of tags since 2005."}),"\n",(0,s.jsx)(t.p,{children:"So if you print errors you can see which rows you need to look at, it may take a while but getting the data in Ampache is definitely worth the effort."}),"\n",(0,s.jsx)(t.p,{children:"You can run this import as many times as you like, the existing play data will not be overwritten."}),"\n",(0,s.jsx)(t.h2,{id:"clean-up-and-duplication",children:"Clean up and duplication"}),"\n",(0,s.jsx)(t.p,{children:"There are 2 queries you'll want to run after this is done"}),"\n",(0,s.jsxs)(t.p,{children:["When Ampache scrobbles a track it checks against the client agent that made the play. If the agent matches is will skip, if the agent doesn't match it will insert. This lets you play on the web while playing on your phone.\n",(0,s.jsx)(t.img,{src:"https://github.com/user-attachments/assets/0acd0c57-2a1f-49e5-b666-ef0464f923c8",alt:"image"})]}),"\n",(0,s.jsxs)(t.p,{children:["When you import it will only reject a scrobble if the agent matches so you'll get dupes. We can find out which ones are duplicates manually. So if you ran this script on top of existing data you will get duplicates (same ",(0,s.jsx)(t.code,{children:"object_id"}),", ",(0,s.jsx)(t.code,{children:"object_type"}),", ",(0,s.jsx)(t.code,{children:"date"}),", ",(0,s.jsx)(t.code,{children:"user"})," but under a different ",(0,s.jsx)(t.code,{children:"agent"}),")"]}),"\n",(0,s.jsx)(t.p,{children:"This query will give you an idea of duplicate plays in your database. (I had 3 in my database)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-mysql",children:"SELECT *\nFROM `object_count`\nWHERE `count_type` = 'stream' AND\n      `date` IN (\n                 SELECT `date`\n                 FROM `object_count`\n                 WHERE `count_type` = 'stream' AND\n                       `object_type` IN ('song', 'podcast_episode')\n                 GROUP BY `object_id`, `object_type`, `date`, `user`, `count_type`\n                 HAVING COUNT(CONCAT(`object_id`, `object_type`, `date`, `user`, `count_type`)) > 1\n      )\nORDER BY `date`, `object_type`;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This action is destructive and will the delete the highest ",(0,s.jsx)(t.code,{children:"id"})," for these plays which will be the most recent inserted row. (we get the dates from songs and podcasts because you can have multiple artist entries for object_count)"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-mysql",children:"DELETE FROM `object_count` WHERE `id` IN (\n    SELECT `id` FROM (\n        SELECT max(`id`) as `id`\n        FROM `object_count`\n        WHERE `count_type` = 'stream' AND\n              `date` IN (\n                         SELECT `date`\n                         FROM `object_count`\n                         WHERE `count_type` = 'stream' AND\n                               `object_type` IN ('song', 'podcast')\n                         GROUP BY `object_id`, `object_type`, `date`, `user`, `count_type`\n                         HAVING COUNT(CONCAT(`object_id`, `object_type`, `date`, `user`, `count_type`)) > 1\n        ) GROUP BY `object_id`, `object_type`, `date`, `user`, `count_type`\n    ) AS `duplicate`\n);\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The key word here is ",(0,s.jsx)(t.strong,{children:"destructive"})," so before you do anything, make sure you back up the database."]}),"\n",(0,s.jsx)(t.p,{children:"I have deleted my stuff so many times over the years and almost lost everything a few times."})]})}function h(e={}){const{wrapper:t}={...(0,o.RP)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,t,a){a.d(t,{RP:()=>o,xA:()=>r});var n=a(6540);const s=n.createContext({});function o(e){const t=n.useContext(s);return n.useMemo(()=>"function"==typeof e?e(t):{...t,...e},[t,e])}const i={};function r({components:e,children:t,disableParentContext:a}){let r;return r=a?"function"==typeof e?e({}):e||i:o(e),n.createElement(s.Provider,{value:r},t)}}}]);