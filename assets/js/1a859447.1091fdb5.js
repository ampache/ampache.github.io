"use strict";(globalThis.webpackChunkampache_org_docs=globalThis.webpackChunkampache_org_docs||[]).push([[7044],{337(e,s,a){a.d(s,{A:()=>n});const n=a.p+"assets/images/136313792-5fbafd05-7bc9-4dc8-8085-80d1b3cc7029-3864163ca57e867d0590c2c4c681e507.png"},2524(e,s,a){a.d(s,{A:()=>n});const n=a.p+"assets/images/136313478-de076b3b-e38c-4779-bc82-8c9cf2c43991-5fe2b0371a12b847aeb411bdd6dd3765.png"},5955(e,s,a){a.d(s,{A:()=>n});const n=a.p+"assets/images/136313859-59ae7259-b74e-4002-8347-2447f4bb8db2-49fcf4556ea023749c4b58bd6f474d01.png"},6291(e,s,a){a.d(s,{A:()=>n});const n=a.p+"assets/images/136309993-4660864a-5d3b-4b00-8c98-5842a790616f-be7a136cf306a529aaf2ad8605f02e5e.png"},8453(e,s,a){a.d(s,{RP:()=>t,xA:()=>o});var n=a(6540);const i=n.createContext({});function t(e){const s=n.useContext(i);return n.useMemo(()=>"function"==typeof e?e(s):{...s,...e},[s,e])}const r={};function o({components:e,children:s,disableParentContext:a}){let o;return o=a?"function"==typeof e?e({}):e||r:t(e),n.createElement(i.Provider,{value:o},s)}},9082(e,s,a){a.r(s),a.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"docs/configuration/Ampache-Icecast-and-Liquidsoap","title":"Ampache + Icecast & Liquidsoap","description":"Ampache + Icecast & Liquidsoap","source":"@site/docs/docs/configuration/Ampache-Icecast-and-Liquidsoap.md","sourceDirName":"docs/configuration","slug":"/docs/configuration/Ampache-Icecast-and-Liquidsoap","permalink":"/docs/configuration/Ampache-Icecast-and-Liquidsoap","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Ampache + Icecast & Liquidsoap","metaTitle":"Ampache + Icecast & Liquidsoap","description":"Ampache + Icecast & Liquidsoap"},"sidebar":"api","previous":{"title":"Democratic Play","permalink":"/docs/configuration/democratic"},"next":{"title":"Multi Artist support","permalink":"/docs/configuration/multi-artist"}}');var i=a(4848),t=a(8453);const r={title:"Ampache + Icecast & Liquidsoap",metaTitle:"Ampache + Icecast & Liquidsoap",description:"Ampache + Icecast & Liquidsoap"},o=void 0,c={},l=[{value:"Ampache and Icecast",id:"ampache-and-icecast",level:2},{value:"Install and configure Icecast2",id:"install-and-configure-icecast2",level:2},{value:"Configure listen-socket&#39;s",id:"configure-listen-sockets",level:3},{value:"Configure ssl for your client socket",id:"configure-ssl-for-your-client-socket",level:3},{value:"Configure a mount point",id:"configure-a-mount-point",level:2},{value:"Restart icecast",id:"restart-icecast",level:3},{value:"Configure Liquidsoap",id:"configure-liquidsoap",level:2},{value:"Get your playlists ready",id:"get-your-playlists-ready",level:3},{value:"Create a liq file for Liquidsoap",id:"create-a-liq-file-for-liquidsoap",level:3},{value:"Add it to Ampache",id:"add-it-to-ampache",level:2},{value:"Create an Apache2 proxy to remove the ports from the url",id:"create-an-apache2-proxy-to-remove-the-ports-from-the-url",level:2}];function d(e){const s={code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,t.RP)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"ampache-and-icecast",children:"Ampache and Icecast"}),"\n",(0,i.jsx)(s.p,{children:"Channels suck, I can't fix them without taking a lot of time for something that is already done better elsewhere."}),"\n",(0,i.jsx)(s.p,{children:"There's actually a pretty easy way to use icecast and Ampache playlists without having to play around with scripts or the api."}),"\n",(0,i.jsx)(s.p,{children:"This assumes you have good enough linux knowledge to configure things, i'll work on making this easier in the future."}),"\n",(0,i.jsx)(s.h2,{id:"install-and-configure-icecast2",children:"Install and configure Icecast2"}),"\n",(0,i.jsx)(s.p,{children:"Install icecast, configure admin accounts, etc and make sure it's all working first."}),"\n",(0,i.jsxs)(s.p,{children:["The default config file has a lot of commented information using ",(0,i.jsx)(s.code,{children:"\x3c!--"})," and ",(0,i.jsx)(s.code,{children:"--\x3e"})," so make sure you're aware of what you delete."]}),"\n",(0,i.jsx)(s.p,{children:"You want to create a source for music to stream to and a source for clients to read the stream from. This is done using sockets."}),"\n",(0,i.jsx)(s.h3,{id:"configure-listen-sockets",children:"Configure listen-socket's"}),"\n",(0,i.jsx)(s.p,{children:"For a user to hear your streams you need sockets."}),"\n",(0,i.jsx)(s.p,{children:"In the config below I'm using socket 8000 to stream to clients (Proxied through my Apache server over ssl) and 8200 is a radio input stream."}),"\n",(0,i.jsx)(s.p,{children:"Configure as many sockets as you want (I have 3 radio streams at home using ports 8200, 8201 and 8202)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-conf",children:"<listen-socket>\n    <port>8000</port>\n    <bind-address>0.0.0.0</bind-address>\n\x3c!-- <ssl>1</ssl> --\x3e\n</listen-socket>\n<listen-socket>\n    <port>8200</port>\n    <bind-address>127.0.0.1</bind-address>\n</listen-socket>\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"note"})," I have commented out the ssl line above. If you're going to proxy through your own web server it doesn't need to be encrypted."]}),"\n",(0,i.jsx)(s.h3,{id:"configure-ssl-for-your-client-socket",children:"Configure ssl for your client socket"}),"\n",(0,i.jsx)(s.p,{children:"If you want to connect directly to icecast instead of through your webserver you'll probably want ssl configured."}),"\n",(0,i.jsx)(s.p,{children:"Make sure the ssl-certificate line is uncommented."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-conf",children:"<ssl-certificate>/usr/share/icecast2/icecast.pem</ssl-certificate>\n"})}),"\n",(0,i.jsx)(s.p,{children:"To make an ssl cert for your server you need to combine the cert, chain and key into one file."}),"\n",(0,i.jsx)(s.p,{children:"If you're using letsencrypt it's pretty easy to do. You just need to know where the cert is"}),"\n",(0,i.jsx)(s.p,{children:"Combine the cert into a single file and change perms for icecast to read it."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"cat /etc/letsencrypt/live/MYSITENAME/privkey.pem /etc/letsencrypt/live/MYSITENAME/cert.pem /etc/letsencrypt/live/MYSITENAME/fullchain.pem >/usr/share/icecast2/icecast.pem\nchmod 600 /usr/share/icecast2/icecast.pem\nchown icecast2:icecast /usr/share/icecast2/icecast.pem\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"note"})," Make sure you set up a cron job or systemd timer if you intend on keeping this going as letsencrypt certs expire pretty quickly"]}),"\n",(0,i.jsx)(s.h2,{id:"configure-a-mount-point",children:"Configure a mount point"}),"\n",(0,i.jsx)(s.p,{children:"Now you need a mount point is where you'll be serving music from."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-conf",children:"<mount>\n    <mount-name>/radio1</mount-name>\n    <username>radio</username>\n    <password>passwordhere</password>\n    <burst-size>65536</burst-size>\n    <bitrate>128</bitrate>\n</mount>\n<mount>\n    <mount-name>/radio2</mount-name>\n    <username>radio</username>\n    <password>passwordhere</password>\n    <burst-size>65536</burst-size>\n    <bitrate>128</bitrate>\n</mount>\n"})}),"\n",(0,i.jsx)(s.h3,{id:"restart-icecast",children:"Restart icecast"}),"\n",(0,i.jsx)(s.p,{children:"After restarting the service i have icecast available on port :8000"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"image",src:a(6291).A+"",width:"973",height:"190"})}),"\n",(0,i.jsx)(s.p,{children:"Now it's time to get it playing music"}),"\n",(0,i.jsx)(s.h2,{id:"configure-liquidsoap",children:"Configure Liquidsoap"}),"\n",(0,i.jsx)(s.p,{children:"First up install liquidsoap from your package manger. Debian is using 1.4.3 which is old but it works fine. We don't need anything special here."}),"\n",(0,i.jsx)(s.h3,{id:"get-your-playlists-ready",children:"Get your playlists ready"}),"\n",(0,i.jsx)(s.p,{children:"With the Ampache cli you can add liquidsoap to the www-group, pull down the playlists and then serve the files to icecast"}),"\n",(0,i.jsx)(s.p,{children:"Add the www-data group to liquidsoap"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"usermod -a -G www-data liquidsoap\n"})}),"\n",(0,i.jsx)(s.p,{children:"Log in as liquidsoap and create the playlists"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"su - liquidsoap -s /bin/bash\nmkdir /usr/share/liquidsoap/playlists\n/var/www/ampache/bin/cli export:playlist /usr/share/liquidsoap/playlists/\n"})}),"\n",(0,i.jsx)(s.p,{children:"You should have an export of all your playlists exported to the playlists folder."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"ls /usr/share/liquidsoap/playlists/\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.em,{children:"Note: Ampache 6 add the possibility to export juste one playlist. Think about it if you have a lot of playlists."})}),"\n",(0,i.jsx)(s.h3,{id:"create-a-liq-file-for-liquidsoap",children:"Create a liq file for Liquidsoap"}),"\n",(0,i.jsx)(s.p,{children:"Now that you're installed and have your playlists with a working Icecast you can start streaming!"}),"\n",(0,i.jsx)(s.p,{children:"Create a config file and make it executable"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"touch /usr/share/liquidsoap/ampache.liq\nchmod +x /usr/share/liquidsoap/ampache.liq\nnano /usr/share/liquidsoap/ampache.liq\n"})}),"\n",(0,i.jsx)(s.p,{children:"Here is my config, make sure you alter to your setup!"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:'#!/usr/bin/liquidsoap\n# Log dir\nset("log.file.path","/var/log/liquidsoap/liquidsoap.log")\n\n# Music\nradio8200 = playlist("~/playlists/2184. bangers user.m3u")\nradio8201 = playlist("~/playlists/14. Rebel Radio mkIII user.m3u")\n\n# Stream it out\noutput.icecast(%mp3.fxp(channels=2,samplerate=44100,bitrate=128),\n  fallible=true,\n  host = "127.0.0.1", port = 8200,\n  user = "radio",  password = "passwordhere",\n  mount = "/radio1",\n  name="bangersRadio", description="",\n  radio8200)\n\noutput.icecast(%mp3.fxp(channels=2,samplerate=44100,bitrate=128),\n  host = "127.0.0.1", port = 8201,\n  user = "radio",  password = "passwordhere",\n  mount = "/radio2",\n  name="rebelRadio", description="",\n  radio8201)\n'})}),"\n",(0,i.jsx)(s.p,{children:"Now that you're configured you can run the liq file as liquidsoap and check out that it's working"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"/usr/share/liquidsoap/ampache.liq\n"})}),"\n",(0,i.jsx)(s.p,{children:"You should get a mount point on the icecast page"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"image",src:a(2524).A+"",width:"486",height:"199"})}),"\n",(0,i.jsx)(s.p,{children:"Radio will now be available from your mount point (https/https depending on your setup)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-URL",children:"http://MYHOST:8000/bangersradio\nhttps://MYHOST:8000/bangersradio\n"})}),"\n",(0,i.jsx)(s.h2,{id:"add-it-to-ampache",children:"Add it to Ampache"}),"\n",(0,i.jsx)(s.p,{children:"Add this link as a live stream in Ampache and you're done."}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"note"})," outside your lan this port needs to be available"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"image",src:a(337).A+"",width:"584",height:"233"})}),"\n",(0,i.jsx)(s.p,{children:"Now you've got live streaming from playlists without the hassle!"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"image",src:a(5955).A+"",width:"818",height:"217"})}),"\n",(0,i.jsx)(s.h2,{id:"create-an-apache2-proxy-to-remove-the-ports-from-the-url",children:"Create an Apache2 proxy to remove the ports from the url"}),"\n",(0,i.jsx)(s.p,{children:"Can't get the ports outside your lan? Add a proxy to your site config and use your Ampache URL for the streams"}),"\n",(0,i.jsxs)(s.p,{children:["In Debian Apache stores the active sites in ",(0,i.jsx)(s.code,{children:"/etc/apache2/sites-enabled/"})]}),"\n",(0,i.jsx)(s.p,{children:"First up make sure you've enabled proxy_html in Apache"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",children:"a2enmod proxy_html\nsystemctl restart apache2\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Here I've set up an ssl proxy here to redirect my streams from ",(0,i.jsx)(s.code,{children:"https://MYHOST:8000/bangersradio"})," to ",(0,i.jsx)(s.code,{children:"https://MYHOST/bangersradio"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-conf",children:"SSLProxyEngine on\nSSLProxyVerify none\nSSLProxyCheckPeerCN off\nSSLProxyCheckPeerName off\nSSLProxyCheckPeerExpire off\nProxyPass /bangersradio https://MYHOST:8000/bangersradio\nProxyPassReverse /bangersradio https://MYHOST:8000/bangersradio\nProxyPass /rebelradio https://MYHOST:8000/rebelradio\nProxyPassReverse /rebelradio https://MYHOST:8000/rebelradio\n"})}),"\n",(0,i.jsx)(s.p,{children:"Don't want icecast on ssl? That's basically the same as https."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-conf",children:"ProxyPass /bangersradio http://MYHOST:8000/bangersradio\nProxyPassReverse /bangersradio http://MYHOST:8000/bangersradio\nProxyPass /rebelradio http://MYHOST:8000/rebelradio\nProxyPassReverse /rebelradio http://MYHOST:8000/rebelradio\n"})})]})}function h(e={}){const{wrapper:s}={...(0,t.RP)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);