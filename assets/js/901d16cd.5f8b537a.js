"use strict";(globalThis.webpackChunkampache_org_docs=globalThis.webpackChunkampache_org_docs||[]).push([[6951],{6802(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"docs/installation/guides/sephtan-installation-guide","title":"Sephten\'s Install guide","description":"Sephten\'s Install guide","source":"@site/docs/docs/installation/guides/sephtan-installation-guide.md","sourceDirName":"docs/installation/guides","slug":"/docs/installation/guides/sephtan-installation-guide","permalink":"/docs/installation/guides/sephtan-installation-guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Sephten\'s Install guide","metaTitle":"Sephten\'s Install guide","description":"Sephten\'s Install guide"},"sidebar":"api","previous":{"title":"Install Ampache on Xampp","permalink":"/docs/installation/guides/tutorial-to-install-ampache-on-xampp"},"next":{"title":"Windows Install on IIS7.5","permalink":"/docs/installation/guides/windows-installation-on-iis7.5-(from-he99)"}}');var a=t(4848),o=t(8453);const s={title:"Sephten's Install guide",metaTitle:"Sephten's Install guide",description:"Sephten's Install guide"},r=void 0,l={},c=[{value:"Guide to setup Ampache server using APACHE2 or NGINX with PHP7.4-FPM",id:"guide-to-setup-ampache-server-using-apache2-or-nginx-with-php74-fpm",level:2},{value:"Were i started from",id:"were-i-started-from",level:2},{value:"Setting up the Server",id:"setting-up-the-server",level:2},{value:"Apache2 with PHP7.4-FPM",id:"apache2-with-php74-fpm",level:3},{value:"Configuring PHP-FPM for Ampache vHost",id:"configuring-php-fpm-for-ampache-vhost",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.RP)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"guide-to-setup-ampache-server-using-apache2-or-nginx-with-php74-fpm",children:"Guide to setup Ampache server using APACHE2 or NGINX with PHP7.4-FPM"}),"\n",(0,a.jsx)(n.p,{children:"This my first guide i write for other people, mainly i do such things only for myself in my personal DokuWiki.\nAs english isn't my first language so be leniant with me when some writings here reads unusual for you."}),"\n",(0,a.jsx)(n.p,{children:"If anyone finds some parts of this guide misleading or incomprehensible i would suggest to open an new discussion about this guide so i am able to get feedback and do improvements."}),"\n",(0,a.jsx)(n.h2,{id:"were-i-started-from",children:"Were i started from"}),"\n",(0,a.jsxs)(n.p,{children:["My personal server experience start around 2009/2010 with an project from the german ",(0,a.jsx)(n.a,{href:"https://www.heise.de/ct/",children:"magazin ct'"})," explaining the setup for an homeserver with xen virtualisation and ipcop as firewall appliance in a virtual host sitting between your homenetwork(green), internet (red) and an eventually existing virtualmachine with an DMZ(orange)."]}),"\n",(0,a.jsx)(n.p,{children:"My first server was setup following that guide using an Atom-D525.\nAbout 01/2014 i updated my setup to an Intel Atom-C2550 from Supermicro with 3 3TB WD Red drives as Raid5 Array for Data-Storage.\nCurrently i am looking for an update, drives are getting old and the chances they die are increasing.\nThe next setup will be with an EPYC-3202 Board again from Supermicro but that future."}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-the-server",children:"Setting up the Server"}),"\n",(0,a.jsx)(n.p,{children:"This setup is for Debian10 Buster so anyone with an different distribution will have to take into account that there might more or less differences for where configuration files reside or that some packages might be not available.\nI am not going to explain the general installation process for any part needed in this guide.\nThe intention is only to give an as complete and comrehensive as possible explanation on how to configure the parts needed."}),"\n",(0,a.jsx)(n.h3,{id:"apache2-with-php74-fpm",children:"Apache2 with PHP7.4-FPM"}),"\n",(0,a.jsx)(n.p,{children:"Intention of my setup:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"separate vHost's against each other using PHP-FPM with one user per vHost (security)"}),"\n",(0,a.jsx)(n.li,{children:"include Modsecurity WAF against attacker's"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"My setup is pretty much automated through a script i use to setup all what is needed for a vHost using PHP-FPM i will provide the script i use for automation at the and of this guide, it's helpful if you regulary setup different vHost's with PHP-FPM.\nThough the setup it's generates has functionality, it is somewhat basic. Some webapplications have special needs that can't be taken into account in a basic setup. That's also not the intention of that script, and the resulting vHost's and PHP-FPM pool configuration have to be adjusted for the individual use case.\nTo understand the configuration it generates, knowledge of the directory Structure is needed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"/var/www\n\u251c\u2500\u2500 [ampache  ampache ]  ampache\n\u2502\xa0\xa0 \u251c\u2500\u2500 [ampache  ampache ]  conf             # folder for the php-fpm socket\n\u2502\xa0\xa0 \u251c\u2500\u2500 [ampache  ampache ]  logs             # your logs can go here\n\u2502\xa0\xa0 \u251c\u2500\u2500 [ampache  ampache ]  public_html      # your document root\n\u2502\xa0\xa0 \u251c\u2500\u2500 [ampache  ampache ]  sessions         # session folder\n\u2502\xa0\xa0 \u2514\u2500\u2500 [ampache  ampache ]  tmp              # folder for temp\n\u251c\u2500\u2500 [clan     clan    ]  clan\n\u2502\xa0\xa0 \u251c\u2500\u2500 [clan     clan    ]  conf             # folder for the php-fpm socket\n\u2502\xa0\xa0 \u251c\u2500\u2500 [clan     clan    ]  logs             # your logs can go here\n\u2502\xa0\xa0 \u251c\u2500\u2500 [clan     clan    ]  public_html      # your document root\n\u2502\xa0\xa0 \u251c\u2500\u2500 [clan     clan    ]  sessions         # session folder\n\u2502\xa0\xa0 \u2514\u2500\u2500 [clan     clan    ]  tmp              # folder for temp\n\u251c\u2500\u2500 [www-data www-data]  nginx\n\u2502\xa0\xa0 \u2514\u2500\u2500 [www-data www-data]  html\n\u2514\u2500\u2500 [wiki     wiki    ]  wiki\n    \u251c\u2500\u2500 [wiki     wiki    ]  conf             # folder for the php-fpm socket\n    \u251c\u2500\u2500 [wiki     wiki    ]  logs             # your logs can go here\n    \u251c\u2500\u2500 [wiki     wiki    ]  public_html      # your document root\n    \u251c\u2500\u2500 [wiki     wiki    ]  sessions         # session folder\n    \u2514\u2500\u2500 [wiki     wiki    ]  tmp              # folder for temp\n"})}),"\n",(0,a.jsx)(n.p,{children:"This is my working virtualhost definition for Apache2 generated by my script and adjusted to the needs of ampache :"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-conf",children:'<VirtualHost 192.168.3.8:80>                                     # IP:Port if running multiple instances *:80 normally\n        ServerName ampache.sandmann.dd-dns.de                    # put your ampache domain here\n        Redirect permanent / https://ampache.sandmann.dd-dns.de/ # put your ampache domain here\n</VirtualHost>\n\n<VirtualHost 192.168.3.8:443>                                    # IP:Port if running multiple instances *:80 normally\n        ServerName newampache.sandmann.dd-dns.de                 # put your ampache domain here\n        ServerAdmin webmaster@.sandmann.dd-dns.de                # same for your e-mail address\n\n        # the SSL part depends on the certificats you supply\n        SSLEngine on\n        SSLCertificateFile /etc/ssl/certs/ampache2.crt\n        SSLCertificateKeyFile /etc/ssl/private/ampache2.key\n\n        SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1\n\n        Alias /ampache /var/www/ampache/public_html/public\n        DocumentRoot /var/www/ampache/public_html/public\n        <Directory /var/www/ampache/public_html/public/>\n                Options Indexes FollowSymLinks\n                AllowOverride all\n                Require all granted\n                <FilesMatch "\\.(php)$">\n                        SetHandler "proxy:unix:/var/www/ampache/conf/ampache-fpm74.sock|fcgi://newampache/"\n                        ProxyErrorOverride on\n                </FilesMatch>\n        </Directory>\n\n        <Location "/server-info">\n                SetHandler server-info\n                ProxyErrorOverride on\n                Require all denied\n                Require ip 192.168.1                    # allowing access only for your home network\n        </Location>\n\n        <Location "/server-status">\n                SetHandler server-status\n                ProxyErrorOverride on\n                Require all denied\n                Require ip 192.168.1                    # allowing access only for your home network\n        </Location>\n        <Location /error/>\n                SetHandler none                         # here you can define an error handler\n        </Location>\n\n        # The complete locationmatch is only for modsecurity\n        # it can be commented out if you feel save\n        # maybe there will be an own chapter regarding modsecurity in this guide\n        # also the SecRuleRemoveById have to be adapted\n        # best is comment them out check error.log and\n        # put only needed rules here\n        <LocationMatch .*>\n            <IfModule mod_security2.c>\n                SecRuleEngine On\n                SecRuleRemoveById 950007                # allow SQL\n                SecRuleRemoveById 950109                # allow Multiple URL Encoding\n                SecRuleRemoveById 950120                # Allow: Possible Remote File Inclusion (RFI) Attack: Off-Domain Reference/Link\n                SecRuleRemoveById 958291                # Allow: Range: field exists and begins with 0\n                SecRuleRemoveById 960024                # Allow: Meta-Character Anomaly Detection Alert - Repetative Non-Word Characters\n                SecRuleRemoveById 960015                # Allow: Request Missing an Accept Header\n                SecRuleRemoveById 970901                # Allow: Matched Data: 500 found within RESPONSE_STATUS: 500\n                SecRuleRemoveById 970903                # Allow: Outbound ASP/JSP\n                SecRuleRemoveById 981054                # Allow: Invalid SessionID Submitted\n                SecRuleRemoveById 981059                # Allow: Warning - Sticky SessionID Data Changed - IP Address Mismatch\n                SecRuleRemoveById 981060                # Allow: Warning - Sticky SessionID Data Changed - User-Agent Mismatch\n                SecRuleRemoveById 981203                # Allow: Inbound Anomaly Score (Total Inbound Score: 3, SQLi=0, XSS=0\n                SecRuleRemoveById 981001                # Allow: Possibly malicious iframe tag in output\n                SecRuleRemoveById 981173                # Allow: Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded\n                SecRuleRemoveById 981184                # Allow: AppDefect: Missing HttpOnly Cookie Flag for ampache_user\n                SecRuleRemoveById 981242                # Allow: Detects classic SQL injection probings\n                SecRuleRemoveById 981243                # Allow: Detects classic SQL injection probings\n                SecRuleRemoveById 981245                # Allow: Detects basic SQL authentication bypass attempts\n                SecRuleRemoveById 981246                # Allow: Detects basic SQL authentication bypass attempts\n                SecRuleRemoveById 981257                # allow: MySQL comment-/space-obfuscated injections and backtick termination.\n                SecRuleRemoveById 981405                # allow: Response Header is Missing or not set to Deny.\n                SecRuleRemoveById 981401                # allow: Content-Type Response Header is Missing or Empty\n                SecRuleRemoveById 981407                # allow: Content-Type Response Header is Missing and X-Content-Type-Options is either missing or not set to \'nosniff\'\n            </IfModule>\n        </LocationMatch>\n\n        ServerSignature Off\n\n        ErrorLog /var/www/ampache/logs/error.log\n        LogLevel warn\n        CustomLog /var/www/ampache/logs/access.log combined\n</VirtualHost>\n'})}),"\n",(0,a.jsx)(n.h3,{id:"configuring-php-fpm-for-ampache-vhost",children:"Configuring PHP-FPM for Ampache vHost"}),"\n",(0,a.jsx)(n.p,{children:"to be continued"})]})}function h(e={}){const{wrapper:n}={...(0,o.RP)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{RP:()=>o,xA:()=>r});var i=t(6540);const a=i.createContext({});function o(e){const n=i.useContext(a);return i.useMemo(()=>"function"==typeof e?e(n):{...n,...e},[n,e])}const s={};function r({components:e,children:n,disableParentContext:t}){let r;return r=t?"function"==typeof e?e({}):e||s:o(e),i.createElement(a.Provider,{value:r},n)}}}]);