"use strict";(globalThis.webpackChunkampache_org_docs=globalThis.webpackChunkampache_org_docs||[]).push([[6380],{6107(e,n,a){a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"docs/configuration/ldap","title":"LDAP","description":"Ampache and LDAP","source":"@site/docs/docs/configuration/ldap.md","sourceDirName":"docs/configuration","slug":"/docs/configuration/ldap","permalink":"/docs/configuration/ldap","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"LDAP","metaTitle":"LDAP","description":"Ampache and LDAP"},"sidebar":"api","previous":{"title":"Remote Catalogs","permalink":"/docs/configuration/remote-catalogs"},"next":{"title":"Ampache API","permalink":"/docs/configuration/api"}}');var i=a(4848),s=a(8453);const o={title:"LDAP",metaTitle:"LDAP",description:"Ampache and LDAP"},c=void 0,l={},r=[{value:"Configuring Ampache for LDAP authentication",id:"configuring-ampache-for-ldap-authentication",level:2},{value:"Enable LDAP as an authentication method",id:"enable-ldap-as-an-authentication-method",level:3},{value:"Enable the automatic user creation",id:"enable-the-automatic-user-creation",level:3},{value:"Configure Ampache&#39;s LDAP client",id:"configure-ampaches-ldap-client",level:3},{value:"TIPs and Gotchas",id:"tips-and-gotchas",level:2},{value:"My users can&#39;t connect, how can I know what is happening",id:"my-users-cant-connect-how-can-i-know-what-is-happening",level:3},{value:"When logging on, I get the message &quot;undefined function ldap_connect()&quot;",id:"when-logging-on-i-get-the-message-undefined-function-ldap_connect",level:3},{value:"Miscellaneous",id:"miscellaneous",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.RP)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"configuring-ampache-for-ldap-authentication",children:"Configuring Ampache for LDAP authentication"}),"\n",(0,i.jsx)(n.h3,{id:"enable-ldap-as-an-authentication-method",children:"Enable LDAP as an authentication method"}),"\n",(0,i.jsxs)(n.p,{children:["You first need to add LDAP to the authentication methods of your Ampache instance: ",(0,i.jsx)(n.code,{children:'auth_methods = "ldap"'})]}),"\n",(0,i.jsxs)(n.p,{children:["The above example does not include MySQL authentication support. Ampache can have multiple authentication methods at the same time. It will try them in the order they are listed until a match is found. If you would like it to try LDAP first, and then fall back on MySQL simply set ",(0,i.jsx)(n.code,{children:"auth_methods"})," as follows: ",(0,i.jsx)(n.code,{children:'auth_methods = "ldap,mysql"'})]}),"\n",(0,i.jsx)(n.h3,{id:"enable-the-automatic-user-creation",children:"Enable the automatic user creation"}),"\n",(0,i.jsxs)(n.p,{children:["As with all others login extension methods, you need to set the ",(0,i.jsx)(n.code,{children:"auto_create"})," and the ",(0,i.jsx)(n.code,{children:"auto_user"})," variables."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"auto_create"})," variable allows Ampache to create new users when they manage to connect using a login extension method (here, LDAP). This variable ",(0,i.jsx)(n.strong,{children:"MUST"})," be set to ",(0,i.jsx)(n.code,{children:"true"}),", otherwise your users wont be able to connect to Ampache."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"auto_user"}),' variable states what status one will obtain by connecting with a login extension method. The default is "guest". The other possible values are "user" and "admin".']}),"\n",(0,i.jsx)(n.h3,{id:"configure-ampaches-ldap-client",children:"Configure Ampache's LDAP client"}),"\n",(0,i.jsxs)(n.p,{children:["You now need to set the ",(0,i.jsx)(n.code,{children:"ldap_*"})," variables that will define the behaviour of Ampache against your LDAP server."]}),"\n",(0,i.jsxs)(n.p,{children:["You ",(0,i.jsx)(n.strong,{children:"MUST"})," set the following variables:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ldap_url"})," (format: ",(0,i.jsx)(n.code,{children:"ldap://my.domain.tld/"}),", ",(0,i.jsx)(n.code,{children:"ldaps://123.456.7.89/"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ldap_search_dn"}),": The DN in which the users will be searched for (usually something like ",(0,i.jsx)(n.code,{children:"ou=people,dc=my,dc=domain,dc=tld"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ldap_objectclass"}),": The objectClass common to all users. In OpenLDAP, this is usually ",(0,i.jsx)(n.code,{children:"posixAccount"}),"; In Microsoft Active Directory, ",(0,i.jsx)(n.code,{children:"organizationalPerson"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ldap_filter"}),": The filter that will be used when searching for the user. The ",(0,i.jsx)(n.code,{children:"%v"})," string will be replaced by the username. For OpenLDAP, try ",(0,i.jsx)(n.code,{children:"(uid=%v)"}),". For Microsoft Active Directory, try ",(0,i.jsx)(n.code,{children:"(sAMAaccountName=%v)"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If you want Ampache to use a specific username/password combination instead of the anonymous login, you'll have to set the ",(0,i.jsx)(n.code,{children:"ldap_username"})," and ",(0,i.jsx)(n.code,{children:"ldap_password"})," variables. Be carefull: ",(0,i.jsx)(n.code,{children:"ldap_username"})," takes a ",(0,i.jsx)(n.strong,{children:"DN"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you want all your users to be in a specific group, you can provide the ",(0,i.jsx)(n.code,{children:"ldap_require_group"})," variable that takes a group DN. Ampache will search for the username in the list of the members of this group. By default, this list is in attribute ",(0,i.jsx)(n.code,{children:"member"}),", but it's not always the case (it might be ",(0,i.jsx)(n.code,{children:"memberuid"})," for instance). If you need to change this attribute name, change the ",(0,i.jsx)(n.code,{children:"ldap_member_attribute"})," variable."]}),"\n",(0,i.jsxs)(n.p,{children:["If you want Ampache to automatically fetch the user's name and/or e-mail from your LDAP server, fill the ",(0,i.jsx)(n.code,{children:"ldap_name_field"})," and ",(0,i.jsx)(n.code,{children:"ldap_email_field"})," variables. ",(0,i.jsx)(n.code,{children:"ldap_name_field"})," can reconstruct a name. If you have for instance the first names of your users in a ",(0,i.jsx)(n.code,{children:"givenName"})," field, and their family name in a ",(0,i.jsx)(n.code,{children:"sn"})," field, you can set ",(0,i.jsx)(n.code,{children:"ldap_name_field"})," to ",(0,i.jsx)(n.code,{children:"givenName sn"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["By default, the LDAP protocol version used is ",(0,i.jsx)(n.strong,{children:"3"}),". You can customize this behaviour with the ",(0,i.jsx)(n.code,{children:"ldap_protocol_version"})," variable."]}),"\n",(0,i.jsxs)(n.p,{children:["If your server can use StartTLS, you may want Ampache to use it. In that case, set the ",(0,i.jsx)(n.code,{children:"ldap_start_tls"})," variable to ",(0,i.jsx)(n.code,{children:'"true"'}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"tips-and-gotchas",children:"TIPs and Gotchas"}),"\n",(0,i.jsx)(n.h3,{id:"my-users-cant-connect-how-can-i-know-what-is-happening",children:"My users can't connect, how can I know what is happening"}),"\n",(0,i.jsxs)(n.p,{children:["Enable Ampache's logging (debug mode). Look in the logs for the lines containing ",(0,i.jsx)(n.code,{children:"(LDAP)"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ShellSession",children:"cat ampache.XXXXX.log | grep '(LDAP)'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"when-logging-on-i-get-the-message-undefined-function-ldap_connect",children:'When logging on, I get the message "undefined function ldap_connect()"'}),"\n",(0,i.jsxs)(n.p,{children:["Make sure PHP's LDAP libraries are installed and accessible (Debian/Ubuntu: ",(0,i.jsx)(n.code,{children:"sudo apt-get install php5-ldap"}),"; Red Hat/Fedora: ",(0,i.jsx)(n.code,{children:"sudo dnf install php-ldap php-mysqlnd php-pdo"}),").\nOnce the libraries are installed, you may need to restart Apache if it is already running. (Debian/Ubuntu: ",(0,i.jsx)(n.code,{children:"sudo service apache2 restart"}),"; Red Hat/Fedora: ",(0,i.jsx)(n.code,{children:"sudo systemctl restart httpd"}),")."]}),"\n",(0,i.jsx)(n.h3,{id:"miscellaneous",children:"Miscellaneous"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Specifying an ",(0,i.jsx)(n.code,{children:"ldap_objectclass"})," value other than ",(0,i.jsx)(n.code,{children:'"*"'})," may cause authentication to fail. Check this value if you are getting authentication failure messages from the login page."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.RP)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,a){a.d(n,{RP:()=>s,xA:()=>c});var t=a(6540);const i=t.createContext({});function s(e){const n=t.useContext(i);return t.useMemo(()=>"function"==typeof e?e(n):{...n,...e},[n,e])}const o={};function c({components:e,children:n,disableParentContext:a}){let c;return c=a?"function"==typeof e?e({}):e||o:s(e),t.createElement(i.Provider,{value:c},n)}}}]);