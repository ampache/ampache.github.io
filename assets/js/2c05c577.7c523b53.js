"use strict";(globalThis.webpackChunkampache_org_docs=globalThis.webpackChunkampache_org_docs||[]).push([[6957],{3776(e,a,n){n.r(a),n.d(a,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"docs/information/upgrade","title":"Upgrading","description":"Upgrading Ampache","source":"@site/docs/docs/information/upgrade.md","sourceDirName":"docs/information","slug":"/docs/information/upgrade","permalink":"/docs/information/upgrade","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Upgrading","metaTitle":"Upgrading","description":"Upgrading Ampache"}}');var i=n(4848),o=n(8453);const t={title:"Upgrading",metaTitle:"Upgrading",description:"Upgrading Ampache"},s=void 0,c={},l=[{value:"Upgrading Ampache",id:"upgrading-ampache",level:2},{value:"Backing up",id:"backing-up",level:2},{value:"Upgrade From Release",id:"upgrade-from-release",level:2},{value:"Upgrade From Source",id:"upgrade-from-source",level:2},{value:"Maintenance mode",id:"maintenance-mode",level:3},{value:"Old versions",id:"old-versions",level:3},{value:"Migrating from Ampache 4.x --&gt; 5.x",id:"migrating-from-ampache-4x----5x",level:4},{value:"Migrating from Ampache 3.4.x --&gt; 3.5",id:"migrating-from-ampache-34x----35",level:4},{value:"Migrating from Ampache 3.3.x --&gt; 3.4",id:"migrating-from-ampache-33x----34",level:4},{value:"Apache rewrite rules",id:"apache-rewrite-rules",level:3}];function d(e){const a={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.RP)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.h2,{id:"upgrading-ampache",children:"Upgrading Ampache"}),"\n",(0,i.jsx)(a.p,{children:"As an assumption we assume you know the path to your Ampache folder and how to manage your permissions."}),"\n",(0,i.jsxs)(a.p,{children:["In this doc we'll use ",(0,i.jsx)(a.code,{children:"/var/www/ampache"})," as the install folder."]}),"\n",(0,i.jsx)(a.h2,{id:"backing-up",children:"Backing up"}),"\n",(0,i.jsx)(a.p,{children:"Every attempt is made to make upgrading your Ampache installation as painless as possible. Although we do everything we can to prevent data loss during an upgrade it is never a bad idea to backup your database before performing an upgrade. Below is a simple command line way to backup your MySQL database. Whenever you upgrade Ampache it is recommend that you run a catalog Verify so that any improvements/changes to the tag reading process are applied to your local collection. The catalog verify is not forced during the upgrade due to the length of time it can take."}),"\n",(0,i.jsx)(a.p,{children:"For MySQL and MariaDB the command is the same:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-shell",children:"mysqldump -u <USERNAME> -p -h localhost <AMPACHEDB> --add-drop-table --allow-keywords > /tmp/ampache.sql\n"})}),"\n",(0,i.jsx)(a.p,{children:"You can restore your database using the mysql command:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-shell",children:"mysql -u <username> -p -h localhost <AMPACHEDB> < /tmp/ampache.sql\n"})}),"\n",(0,i.jsxs)(a.p,{children:[(0,i.jsx)(a.strong,{children:"Note"})," the ",(0,i.jsx)(a.code,{children:"<"})," and ",(0,i.jsx)(a.code,{children:">"})," tell you which way the restore is going from"]}),"\n",(0,i.jsx)(a.h2,{id:"upgrade-from-release",children:"Upgrade From Release"}),"\n",(0,i.jsxs)(a.p,{children:['Upgrading an Ampache release version is a "drop-in" replacement for an older version. (Unless you\'re upgrading from ',(0,i.jsx)(a.a,{href:"/docs/old-information/ampache5-changes",children:"Ampache4 -> Ampache5"}),")"]}),"\n",(0,i.jsx)(a.p,{children:"You can extract over the top of your current install if you want but we'll follow a Moodle style approach by moving the old folder first."}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:["Move the old folder out of the way.","\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.code,{children:"mv /var/www/ampache /var/www/ampache.old"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(a.li,{children:["Grab the release you want from the ",(0,i.jsx)(a.a,{href:"https://github.com/ampache/ampache/releases",children:"releases"})," page"]}),"\n",(0,i.jsxs)(a.li,{children:["Extract the new version.","\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.code,{children:"unzip ampache-X.X.X_all.zip -d /var/www/ampache"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(a.li,{children:["Copy your config file from the old install to the new directory","\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:(0,i.jsx)(a.code,{children:"cp /var/www/ampache.old/config/ampache.cfg.php /var/www/ampache/config/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(a.h2,{id:"upgrade-from-source",children:"Upgrade From Source"}),"\n",(0,i.jsxs)(a.p,{children:["Did you use ",(0,i.jsx)(a.a,{href:"/docs/installation#download-ampache",children:"git"}),"?"]}),"\n",(0,i.jsx)(a.p,{children:"If you've been downloading tar.gz source archives, it's probably better to switch to git."}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:["Pull the repo with ",(0,i.jsx)(a.code,{children:"git pull"})]}),"\n",(0,i.jsxs)(a.li,{children:["Pull the composer deps ",(0,i.jsx)(a.code,{children:"composer install --prefer-source --no-interaction"})]}),"\n",(0,i.jsx)(a.li,{children:"Attempt to login as normal, Ampache will prompt you for any database upgrades which must be performed"}),"\n"]}),"\n",(0,i.jsx)(a.h3,{id:"maintenance-mode",children:"Maintenance mode"}),"\n",(0,i.jsx)(a.p,{children:"If you attempt to run migration or custom scripts, it's good practice to put your website in maintenance mode to avoid users doing mistakes during that time."}),"\n",(0,i.jsxs)(a.p,{children:["To put Ampache in maintenance mode, simply create a new ",(0,i.jsx)(a.code,{children:".maintenance"})," file in Ampache root directory. An example redirecting a page hosted in ampache.org is provided under ",(0,i.jsx)(a.code,{children:".maintenance.example"})," file."]}),"\n",(0,i.jsxs)(a.p,{children:["When creating your custom message, don't forget to add ",(0,i.jsx)(a.code,{children:"exit;"})," at the end to stop the script going further."]}),"\n",(0,i.jsx)(a.h3,{id:"old-versions",children:"Old versions"}),"\n",(0,i.jsx)(a.h4,{id:"migrating-from-ampache-4x----5x",children:"Migrating from Ampache 4.x --\x3e 5.x"}),"\n",(0,i.jsxs)(a.p,{children:["Ampache5 has changes the website path so check out the ",(0,i.jsx)(a.a,{href:"/docs/installation#emplacement",children:"wiki"})," for information about how it's been moved into the project public folder."]}),"\n",(0,i.jsx)(a.h4,{id:"migrating-from-ampache-34x----35",children:"Migrating from Ampache 3.4.x --\x3e 3.5"}),"\n",(0,i.jsx)(a.p,{children:"If Ampache reports that your config file is 'unreadable' after upgrading open your config file and remove all configuration options relating to RSS Feeds, these options should be at the bottom.  This is due to a change in PHP versions which is often done at the same time as an Ampache upgrade."}),"\n",(0,i.jsx)(a.h4,{id:"migrating-from-ampache-33x----34",children:"Migrating from Ampache 3.3.x --\x3e 3.4"}),"\n",(0,i.jsx)(a.p,{children:"Ampache 3.4 Introduces a new config format. Still follow the basic instructions however when attempting to login Ampache will redirect you to a different update page telling you that your ampache.cfg.php is out of date and must be updated. Run the command line script as instructed before continuing."}),"\n",(0,i.jsx)(a.h3,{id:"apache-rewrite-rules",children:"Apache rewrite rules"}),"\n",(0,i.jsx)(a.p,{children:"Make sure you don't forget to re-copy over the htaccess rules if you're using Apache."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-shell",children:"cp /var/www/ampache/public/rest/.htaccess.dist /var/www/ampache/public/rest/.htaccess\ncp /var/www/ampache/public/play/.htaccess.dist /var/www/ampache/public/play/.htaccess\ncp /var/www/ampache/public/channel/.htaccess.dist /var/www/ampache/public/channel/.htaccess\n"})})]})}function h(e={}){const{wrapper:a}={...(0,o.RP)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,a,n){n.d(a,{RP:()=>o,xA:()=>s});var r=n(6540);const i=r.createContext({});function o(e){const a=r.useContext(i);return r.useMemo(()=>"function"==typeof e?e(a):{...a,...e},[a,e])}const t={};function s({components:e,children:a,disableParentContext:n}){let s;return s=n?"function"==typeof e?e({}):e||t:o(e),r.createElement(i.Provider,{value:s},a)}}}]);